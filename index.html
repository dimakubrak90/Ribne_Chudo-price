<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Сканер цін</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    height: 100%;
    overflow: hidden;
}

.container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100%;
    text-align: center;
}

.title {
    font-size: 36px;
    opacity: 0.8;
    margin-bottom: 20px;
}

.hint {
    font-size: 22px;
    opacity: 0.5;
    margin-bottom: 30px;
}

.product {
    font-size: 34px;
    margin-bottom: 20px;
}

.price {
    font-size: 60px;
    font-weight: bold;
    color: #00ff88;
}

.error {
    color: #ff5555;
}

/* input для сканера */
#scannerInput {
    position: absolute;
    top: -100px;
    opacity: 0;
}
</style>
</head>

<body>
<div class="container">
    <div class="title">Скануйте товар</div>
    <div class="hint" id="hint">Натисніть OK для початку</div>
    <div class="product" id="product">—</div>
    <div class="price" id="price">—</div>
</div>

<input
    type="text"
    id="scannerInput"
    autocomplete="off"
    autocorrect="off"
    spellcheck="false"
/>
<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw0T5HLy5L5g6ydht5IL8xexWzwdJdDx-PzsqbGo02dGV5wvJcfHbXYH-nQon2v9_1N1w/exec";

const input = document.getElementById("scannerInput");
const productEl = document.getElementById("product");
const priceEl = document.getElementById("price");
const hintEl = document.getElementById("hint");

let activated = false;

// ✅ 1. АКТИВАЦІЯ ЧЕРЕЗ ENTER / OK
document.addEventListener("keydown", (e) => {
    if (!activated && (e.key === "Enter" || e.key === "OK")) {
        activated = true;
        hintEl.style.display = "none";

        input.focus();

        // ✅ приховуємо клавіатуру
        setTimeout(() => {
            input.blur();
            input.focus();
        }, 100);
    }
});

// ✅ 2. СКАНУВАННЯ
let scanTimeout = null;

input.addEventListener("input", () => {
    if (scanTimeout) clearTimeout(scanTimeout);

    scanTimeout = setTimeout(() => {
        const barcode = input.value.trim();
        input.value = "";

        if (barcode.length < 4) return;
        handleScan(barcode);
    }, 50);
});

function handleScan(barcode) {
    productEl.classList.remove("error");
    productEl.textContent = "Пошук...";
    priceEl.textContent = "";

    fetch(API_URL + "?barcode=" + encodeURIComponent(barcode))
        .then(r => r.json())
        .then(data => {
            if (data.error) {
                productEl.textContent = "Товар не знайдено";
                productEl.classList.add("error");
                return;
            }

            productEl.textContent = data.name;
            priceEl.textContent = data.price + " грн";
        })
        .catch(() => {
            productEl.textContent = "Помилка зʼєднання";
            productEl.classList.add("error");
        });
}
</script>
</body>
</html>
