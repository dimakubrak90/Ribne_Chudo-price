<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Перевірка ціни</title>

<style>
    body {
        margin: 0;
        background: #111;
        color: #fff;
        font-family: Arial, sans-serif;
        text-align: center;
    }

    .container {
        padding: 40px;
    }

    h1 {
        font-size: 42px;
        margin-bottom: 10px;
    }

    #status {
        font-size: 26px;
        margin: 20px 0;
        color: #aaa;
    }

    #barcodeView {
        font-size: 22px;
        margin: 10px 0;
        color: #666;
    }

    #price {
        font-size: 72px;
        font-weight: bold;
        margin-top: 30px;
        color: #00ff99;
    }
</style>
</head>

<body>
<div class="container">
    <h1>Перевірка ціни</h1>
    <div id="status">Скануйте штрихкод</div>
    <div id="barcodeView"></div>
    <div id="price"></div>
</div>
<script>
const API_URL = "https://ribne-chudo-price.netlify.app/"; // ✅ залиш як є

let buffer = "";
let lastKeyTime = Date.now();

document.addEventListener("keydown", (e) => {
    // ❌ ігноруємо кнопки пульта
    if (
        e.key === "Enter" && buffer.length === 0 ||
        e.key.startsWith("Arrow") ||
        e.key === "Back" ||
        e.key === "Home"
    ) {
        return;
    }

    const now = Date.now();

    // якщо пауза між символами >100мс — це не сканер
    if (now - lastKeyTime > 100) {
        buffer = "";
    }

    lastKeyTime = now;

    // ✅ Enter від СКАНЕРА = кінець коду
    if (e.key === "Enter") {
        if (buffer.length >= 6) {
            handleBarcode(buffer);
        }
        buffer = "";
        return;
    }

    // ✅ тільки цифри
    if (/^[0-9]$/.test(e.key)) {
        buffer += e.key;
        document.getElementById("barcodeView").innerText =
            "Код: " + buffer;
    }
});

function handleBarcode(code) {
    document.getElementById("status").innerText = "Пошук ціни...";
    document.getElementById("price").innerText = "";

    fetch(API_URL + "?barcode=" + code)
        .then(res => res.json())
        .then(data => {
            if (data.price) {
                document.getElementById("price").innerText =
                    data.price + " грн";
                document.getElementById("status").innerText =
                    data.name || "Знайдено";
            } else {
                document.getElementById("status").innerText =
                    "Товар не знайдено";
            }
        })
        .catch(() => {
            document.getElementById("status").innerText =
                "Помилка з'єднання";
        });
}
</script>
</body>
</html>
