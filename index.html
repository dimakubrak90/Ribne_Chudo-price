<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Сканер цін</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    height: 100%;
    overflow: hidden;
}

.container {
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
}

.title {
    font-size: 36px;
    margin-bottom: 30px;
}

.product {
    font-size: 34px;
    margin-bottom: 20px;
}

.price {
    font-size: 60px;
    font-weight: bold;
    color: #00ff88;
}

.error {
    color: #ff5555;
}

/* реальний input для сканера */
#scannerInput {
    position: absolute;
    top: -100px;
    opacity: 0;
}
</style>
</head>
<body>

<div class="container">
    <div class="title">Скануйте товар</div>
    <div id="product" class="product">—</div>
    <div id="price" class="price">—</div>
</div>

<input
    id="scannerInput"
    type="text"
    readonly
    inputmode="none"
    autocomplete="off"
    autocorrect="off"
    spellcheck="false"
/>
<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw0T5HLy5L5g6ydht5IL8xexWzwdJdDx-PzsqbGo02dGV5wvJcfHbXYH-nQon2v9_1N1w/exec";

const input = document.getElementById("scannerInput");
const productEl = document.getElementById("product");
const priceEl = document.getElementById("price");

/* ✅ ЗАВЖДИ ТРИМАЄМО ФОКУС */
function forceFocus() {
    input.focus();
}
setInterval(forceFocus, 300);
window.onload = forceFocus;
document.body.addEventListener("click", forceFocus);

/* ✅ СТАБІЛЬНЕ СКАНУВАННЯ */
let scanTimer = null;

input.addEventListener("input", () => {
    clearTimeout(scanTimer);

    scanTimer = setTimeout(() => {
        const code = input.value.trim();
        input.value = "";

        if (code.length < 4) return;
        scan(code);
    }, 80);
});

function scan(barcode) {
    productEl.classList.remove("error");
    productEl.textContent = "Пошук...";
    priceEl.textContent = "";

    fetch(API_URL + "?barcode=" + encodeURIComponent(barcode))
        .then(r => r.json())
        .then(data => {
            if (data.error) {
                productEl.textContent = "Товар не знайдено";
                productEl.classList.add("error");
                return;
            }

            productEl.textContent = data.name;
            priceEl.textContent = data.price + " грн";
        })
        .catch(() => {
            productEl.textContent = "Помилка зʼєднання";
            productEl.classList.add("error");
        });
}
</script>
</body>
</html>
